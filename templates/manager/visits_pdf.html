{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visits Report</title>

  <style>
    /* -------- PAGE SETUP -------- */
    @page {
      size: A4 landscape;
      margin: 8mm;
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 9pt;
      line-height: 1.2;
      color: #111;
    }

    h3 { margin: 0 0 8px; font-size: 11pt; }
    .meta { margin: 0 0 8px; font-size: 8.5pt; }

    /* -------- TABLE -------- */
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    thead { display: table-header-group; }
    tr { break-inside: avoid; page-break-inside: avoid; }

    th, td {
      border: 0.6px solid #444;
      padding: 3px;
      vertical-align: top;
      text-align: left;
      font-size: 8pt;
      overflow-wrap: anywhere;
      word-break: break-word;
      hyphens: auto;
    }
    thead th {
      background: #f1f3f5;
      font-weight: 700;
      font-size: 8.5pt;
    }

    /* -------- FIXED COLUMN WIDTHS -------- */
    colgroup col:nth-child(1)  { width: 3%; }
    colgroup col:nth-child(2)  { width: 10%; } /* Production Line */
    colgroup col:nth-child(3)  { width: 12%; } /* Client / Company */
    colgroup col:nth-child(4)  { width: 10%; } /* Contact Person */
    colgroup col:nth-child(5)  { width: 10%; } /* Contact Number */
    colgroup col:nth-child(6)  { width: 8%; }  /* Designation */
    colgroup col:nth-child(7)  { width: 14%; } /* Location */
    colgroup col:nth-child(8)  { width: 8%; }  /* Order Quoted */
    colgroup col:nth-child(9)  { width: 10%; } /* Order Amount */
    colgroup col:nth-child(10) { width: 15%; } /* Reason */

    /* -------- BADGES -------- */
    .badge {
      display: inline-block;
      padding: 1px 3px;
      border-radius: 3px;
      font-weight: 700;
      font-size: 7.5pt;
      color: #fff;
    }
    .bg-success { background: #28a745; }
    .bg-danger  { background: #dc3545; }

    .hr { border: none; border-top: 1px solid #ccc; margin: 6px 0 8px; }

    /* -------- PRINT RULES -------- */
    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      table { page-break-inside: auto; }
      tr    { page-break-inside: avoid; page-break-after: auto; }
      thead { display: table-header-group; }
      tfoot { display: table-footer-group; }
    }
  </style>
</head>
<body>

  <h3>All Visits Report</h3>
  <p class="meta">
    {% if created_date %}<strong>Filtered Date:</strong> {{ created_date }}<br>{% endif %}
    <strong>Total Quoted Orders:</strong> {{ total_quoted_count|default:"0" }}<br>
    <strong>Total Amount:</strong> {{ total_order_amount|default:"0"|floatformat:2|intcomma }}
  </p>
  <hr class="hr"/>

  <table>
    <colgroup>
      <col><col><col><col><col><col><col><col><col><col>
    </colgroup>
    <thead>
      <tr>
        <th>#</th>
        <th>Production Line</th>
        <th>Client / Company</th>
        <th>Contact Person</th>
        <th>Contact Number</th>
        <th>Designation</th>
        <th>Location</th>
        <th>Order Quoted</th>
        <th>Order Amount</th>
        <th>Reason (if No Order)</th>
      </tr>
    </thead>
    <tbody>
      {% for v in visits %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ v.get_productionline_display }}</td>
        <td>{{ v.company_name }}</td>
        <td>{{ v.contact_person }}</td>
        <td>{{ v.contact_number }}</td>
        <td>{{ v.designation }}</td>
        <td>
          {% if v.latitude and v.longitude %}
            {{ v.place_name }}<br/>
            <small>{{ v.region }} {{ v.zone }} {{ v.nation }}</small>
          {% else %}
            Not Available
          {% endif %}
        </td>
        <td>
          {% if v.is_order_quoted %}
            <span class="badge bg-success">Yes</span>
          {% else %}
            <span class="badge bg-danger">No</span>
          {% endif %}
        </td>
        <td>
          {% if v.is_order_quoted %}
            {{ v.order_amount|default:"0"|floatformat:2|intcomma }}
          {% else %}N/A{% endif %}
        </td>
        <td>{{ v.reason_no_order|default:"N/A" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
